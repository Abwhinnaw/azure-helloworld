trigger:
- main

pool:
  name: Self-Hosted-Agent

variables:
  staticVar: 'my value' # static variable
  compileVar: ${{ variables.staticVar }} # compile time expression
  isMain: $[eq(variables['Build.SourceBranch'], 'refs/heads/main')] # runtime expression
  - name: one
    value: initialValue 


stages:
- stage:
  displayName: "Stage A"
  jobs:
  - job: Test
    steps:
      - script: |
          echo ${{ variables.one }} # outputs initialValue
          echo $(one)
        displayName: First variable pass
      - bash: echo '##vso[task.setvariable variable=one]secondValue'
        displayName: Set new variable value
      - script: |
          echo ${{ variables.one }} # outputs initialValue
          echo $(one) # outputs secondValue
        displayName: Second variable pass
      - bash: echo $(one)
      - powershell: echo $(one)
      - script: echo $(one)
- stage: 
  displayName: "Stage B"
  condition: and(succeeded(), eq(variables.isMain, 'true'))
  jobs:
  - job: B1
    steps:
      - script: echo Hello Stage B!

